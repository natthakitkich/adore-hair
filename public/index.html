<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adore hair studio</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<!-- =========================
     LOGIN OVERLAY
========================= -->
<div id="loginOverlay" class="overlay">
  <div class="modal">
    <div class="modalBody">
      <div class="avatar big">
        <img src="logo.png" alt="Adore Hair Logo" />
        A
      </div>
      <h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
      <p class="muted">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà PIN 4 ‡∏´‡∏•‡∏±‡∏Å</p>

      <input
        id="pin"
        type="password"
        inputmode="numeric"
        maxlength="4"
        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
      />

      <button id="loginBtn" class="primary" type="button">
        Login
      </button>

      <div id="loginMsg" class="msg err"></div>
    </div>
  </div>
</div>

<!-- =========================
     EDIT BOOKING MODAL (RESCHEDULE ENABLED)
========================= -->
<div id="editOverlay" class="overlay hidden">
  <div class="modal">
    <div class="modalBody">
      <h2>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç / ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏¥‡∏ß</h2>

      <!-- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡πÉ‡∏´‡∏°‡πà) -->
      <input id="editDate" type="date" />

      <!-- ‡πÄ‡∏ß‡∏•‡∏≤ (‡πÉ‡∏´‡∏°‡πà: ‡πÉ‡∏ä‡πâ select) -->
      <select id="editTime"></select>

      <!-- ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏° (‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß) -->
      <input id="editTimeOld" disabled style="display:none" />

      <!-- ‡∏ä‡πà‡∏≤‡∏á (lock ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) -->
      <input id="editStylist" disabled />

      <input id="editName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤" />
      <input id="editPhone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£" />

      <div class="row">
        <label>
          <input type="radio" name="editGender" value="male" /> üë® ‡∏ä‡∏≤‡∏¢
        </label>
        <label>
          <input type="radio" name="editGender" value="female" /> üë© ‡∏´‡∏ç‡∏¥‡∏á
        </label>
      </div>

      <input id="editService" placeholder="‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£" />

      <button id="saveEdit" class="primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏¥‡∏ß</button>
      <button id="deleteEdit" class="ghost">‡∏•‡∏ö‡∏Ñ‡∏¥‡∏ß</button>
      <button id="closeEdit" class="ghost">‡∏õ‡∏¥‡∏î</button>
    </div>
  </div>
</div>

<!-- =========================
     TOP BAR
========================= -->
<div class="topbar">
  <div class="brand">
    <div class="avatar">
      <img src="logo.png" alt="Adore Hair Logo" />
      A
    </div>
    <div>
      <div class="title">Adore hair studio</div>
      <div class="subtitle">
        Owner Queue ¬∑ 13:00‚Äì22:00 ¬∑ ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏≤‡∏á
      </div>
    </div>
  </div>

  <button id="logoutBtn" class="ghost">Logout</button>
</div>

<!-- =========================
     MAIN CONTENT (SINGLE PAGE)
========================= -->
<div class="wrap">

  <!-- ===== CALENDAR ===== -->
  <section class="panel">
    <div class="calendarHeader">
      <button id="prevMonth" class="ghost">‚Äπ</button>
      <div id="calendarTitle" class="calendarTitle">‚Äî</div>
      <button id="nextMonth" class="ghost">‚Ä∫</button>
    </div>

    <div class="calendarGrid">
      <div class="dayLabel">‡∏≠‡∏≤</div>
      <div class="dayLabel">‡∏à</div>
      <div class="dayLabel">‡∏≠</div>
      <div class="dayLabel">‡∏û</div>
      <div class="dayLabel">‡∏û‡∏§</div>
      <div class="dayLabel">‡∏®</div>
      <div class="dayLabel">‡∏™</div>

      <div id="calendarDays" class="calendarDays"></div>
    </div>

    <div class="calendarLegend">
      <span class="dot low"></span> ‡∏Ñ‡∏¥‡∏ß‡∏ô‡πâ‡∏≠‡∏¢
      <span class="dot mid"></span> ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á
      <span class="dot high"></span> ‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô
    </div>
  </section>

  <!-- ===== SUMMARY ===== -->
  <section class="panel">
    <div class="summary">
      <div class="box">Bank<br><strong id="countBank">0</strong></div>
      <div class="box">Sindy<br><strong id="countSindy">0</strong></div>
      <div class="box">Assist<br><strong id="countAssist">0</strong></div>
      <div class="box">‡∏£‡∏ß‡∏°<br><strong id="countTotal">0</strong></div>
    </div>
  </section>

  <!-- ===== BOOKING ===== -->
  <section class="panel">

    <div class="tabs">
      <div class="tab active" data-tab="Bank">Bank</div>
      <div class="tab" data-tab="Sindy">Sindy</div>
      <div class="tab" data-tab="Assist">Assist</div>
    </div>

    <form id="bookingForm" class="grid">
      <div>
        <label>‡πÄ‡∏ß‡∏•‡∏≤</label>
        <select id="time"></select>
      </div>

      <div>
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
        <input id="name" required />
      </div>

      <div>
        <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
        <input id="phone" />
      </div>

      <div>
        <label>‡πÄ‡∏û‡∏®</label>
        <div class="row">
          <label><input type="radio" name="gender" value="male" required /> üë®</label>
          <label><input type="radio" name="gender" value="female" /> üë©</label>
        </div>
      </div>

      <div class="full">
        <label>‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£</label>
        <input id="service" />
      </div>

      <div class="full">
        <button type="submit" class="primary">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏¥‡∏ß</button>
      </div>
    </form>
  </section>

  <!-- ===== TABLE ===== -->
  <section class="panel">
    <table>
      <thead>
        <tr>
          <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
          <th>‡∏ä‡πà‡∏≤‡∏á</th>
          <th>‡πÄ‡∏û‡∏®</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠</th>
          <th>‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£</th>
          <th>‡πÇ‡∏ó‡∏£</th>
          <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody id="list"></tbody>
    </table>
  </section>

</div>

<script src="app.js"></script>
</body>
</html>

‡πÅ‡∏•‡∏∞‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ public/app.js
const API = '';
const OWNER_PIN = '1234';

/* =========================
   ELEMENTS
========================= */
const loginOverlay = document.getElementById('loginOverlay');
const loginBtn = document.getElementById('loginBtn');
const pinInput = document.getElementById('pin');
const loginMsg = document.getElementById('loginMsg');
const logoutBtn = document.getElementById('logoutBtn');

const calendarTitle = document.getElementById('calendarTitle');
const calendarDaysEl = document.getElementById('calendarDays');
const prevMonthBtn = document.getElementById('prevMonth');
const nextMonthBtn = document.getElementById('nextMonth');

const bookingForm = document.getElementById('bookingForm');
const timeSelect = document.getElementById('time');
const listEl = document.getElementById('list');

/* =========================
   STATE
========================= */
let bookings = [];
let calendarDensity = {};

let selectedStylist = 'Bank';
let selectedDate = getTodayTH();

let viewMonth = new Date(selectedDate).getMonth();
let viewYear = new Date(selectedDate).getFullYear();

/* =========================
   LOGIN
========================= */
loginBtn.onclick = () => {
  const pin = pinInput.value.trim();
  loginMsg.textContent = '';

  if (pin.length !== 4) {
    loginMsg.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà PIN 4 ‡∏´‡∏•‡∏±‡∏Å';
    return;
  }

  if (pin !== OWNER_PIN) {
    loginMsg.textContent = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
    return;
  }

  localStorage.setItem('adore_logged_in', '1');
  loginOverlay.classList.add('hidden');
  init();
};

logoutBtn.onclick = () => {
  localStorage.removeItem('adore_logged_in');
  location.reload();
};

document.addEventListener('DOMContentLoaded', () => {
  if (localStorage.getItem('adore_logged_in') === '1') {
    loginOverlay.classList.add('hidden');
    init();
  }
});

/* =========================
   INIT
========================= */
function init() {
  bindStylistTabs();
  loadCalendar();
  loadBookings();
}

/* =========================
   CALENDAR
========================= */
async function loadCalendar() {
  const res = await fetch(`${API}/calendar-days`);
  calendarDensity = await res.json();
  renderCalendar();
}

function renderCalendar() {
  calendarDaysEl.innerHTML = '';

  const firstDay = new Date(viewYear, viewMonth, 1);
  const startDay = firstDay.getDay();
  const daysInMonth = new Date(viewYear, viewMonth + 1, 0).getDate();

  calendarTitle.textContent =
    firstDay.toLocaleDateString('th-TH', { month: 'long', year: 'numeric' });

  for (let i = 0; i < startDay; i++) {
    calendarDaysEl.appendChild(document.createElement('div'));
  }

  for (let d = 1; d <= daysInMonth; d++) {
    const date = `${viewYear}-${String(viewMonth + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
    const count = calendarDensity[date] || 0;

    const el = document.createElement('div');
    el.className = 'day';
    el.textContent = d;

    if (date === selectedDate) el.classList.add('today');
    if (count > 0 && count <= 5) el.classList.add('low');
    if (count > 5 && count <= 10) el.classList.add('mid');
    if (count > 10) el.classList.add('high');

    el.onclick = () => {
      selectedDate = date;
      loadBookings();
      renderCalendar();
    };

    calendarDaysEl.appendChild(el);
  }
}

prevMonthBtn.onclick = () => {
  viewMonth--;
  if (viewMonth < 0) {
    viewMonth = 11;
    viewYear--;
  }
  renderCalendar();
};

nextMonthBtn.onclick = () => {
  viewMonth++;
  if (viewMonth > 11) {
    viewMonth = 0;
    viewYear++;
  }
  renderCalendar();
};

/* =========================
   BOOKINGS
========================= */
async function loadBookings() {
  const res = await fetch(`${API}/bookings?date=${selectedDate}`);
  bookings = await res.json();

  renderSummary();
  renderTimeOptions();
  renderTable();
}

function bindStylistTabs() {
  document.querySelectorAll('.tab').forEach(tab => {
    tab.onclick = () => {
      document.querySelector('.tab.active').classList.remove('active');
      tab.classList.add('active');
      selectedStylist = tab.dataset.tab;
      renderTimeOptions();
    };
  });
}

function renderTimeOptions() {
  timeSelect.innerHTML = '';

  for (let h = 13; h <= 22; h++) {
    const time = `${String(h).padStart(2, '0')}:00:00`;
    const booked = bookings.find(
      b => b.time === time && b.stylist === selectedStylist
    );

    const opt = document.createElement('option');
    opt.value = time;
    opt.textContent = time.slice(0, 5);
    if (booked) opt.disabled = true;

    timeSelect.appendChild(opt);
  }
}

/* =========================
   FORM SUBMIT
========================= *
